[phases.setup]
nixPkgs = ['nodejs_20', 'pnpm']

[phases.install]
cmds = ['pnpm install --no-frozen-lockfile']

[phases.build]
cmds = [
  'cd packages/db && pnpm prisma generate',
  'cd packages/db && pnpm prisma db push --accept-data-loss',
  'cd apps/web && NODE_ENV=production pnpm build'
]

[start]
cmd = 'cd apps/web && pnpm start'

[variables]
PORT = '3000'
